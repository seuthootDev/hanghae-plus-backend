# λ™μ‹μ„± μ μ–΄ λ³΄κ³ μ„

## π“‹ λ©μ°¨
1. [λ¬Έμ  μ‹λ³„](#λ¬Έμ -μ‹λ³„)
2. [λ™μ‹μ„± λ¬Έμ  λ¶„μ„](#λ™μ‹μ„±-λ¬Έμ -λ¶„μ„)
3. [ν•΄κ²° λ°©μ•](#ν•΄κ²°-λ°©μ•)
4. [κµ¬ν„ κ²°κ³Ό](#κµ¬ν„-κ²°κ³Ό)
5. [ν…μ¤νΈ λ° κ²€μ¦](#ν…μ¤νΈ-λ°-κ²€μ¦)
6. [ν–¥ν›„ ν™•μ¥ κ³„ν](#ν–¥ν›„-ν™•μ¥-κ³„ν)

---

## π” λ¬Έμ  μ‹λ³„

### 1.1 λ™μ‹μ„± λ¬Έμ κ°€ λ°μƒν•λ” μ„λΉ„μ¤ μμ—­

μ΄μ»¤λ¨Έμ¤ μ„λΉ„μ¤μ—μ„ λ‹¤μκ³Ό κ°™μ€ λ™μ‹μ„± λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤:

#### **1.1.1 μΏ ν° λ°κΈ‰**
- **λ¬Έμ **: μ„ μ°©μ μΏ ν° λ°κΈ‰ μ‹ λ™μ‹ μ”μ²­μΌλ΅ μΈν• μ¤‘λ³µ λ°κΈ‰
- **μν–¥**: μΏ ν° μλ‰ μ΄κ³Ό, κ³µμ •μ„± λ¬Έμ 
- **μμ‹**: 100κ° μΏ ν°μ— 200λ…μ΄ λ™μ‹ μ”μ²­ μ‹ 100κ° μ΄κ³Ό λ°κΈ‰ κ°€λ¥

#### **1.1.2 ν¬μΈνΈ μ¶©μ „/μ°¨κ°**
- **λ¬Έμ **: λ™μ‹ ν¬μΈνΈ μ¶©μ „/μ°¨κ° μ‹ λ°μ΄ν„° λ¶μΌμΉ
- **μν–¥**: ν¬μΈνΈ μ”μ•΅ μ¤λ¥, μ¬λ¬΄μ  μ†μ‹¤
- **μμ‹**: 1000ν¬μΈνΈμ—μ„ λ™μ‹μ— 500ν¬μΈνΈ μ°¨κ° μ‹ -500ν¬μΈνΈ λ°μƒ κ°€λ¥

#### **1.1.3 μ£Όλ¬Έ μƒμ„±**
- **λ¬Έμ **: λ™μ‹ μ£Όλ¬Έ μ‹ μ¬κ³  μ¤‘λ³µ μ°¨κ°, μΏ ν° μ¤‘λ³µ μ‚¬μ©
- **μν–¥**: μ¬κ³  λ¶€μ΅±, μΏ ν° μ¤μ©
- **μμ‹**: μ¬κ³  1κ°μ— 2λ…μ΄ λ™μ‹ μ£Όλ¬Έ μ‹ μ¬κ³  -2 λ°μƒ, ν•λ‚μ μΏ ν°μΌλ΅ 2κ°μ μ£Όλ¬Έ μƒμ„± λ“±

#### **1.1.4 νμ›κ°€μ…**
- **λ¬Έμ **: λ™μ‹ νμ›κ°€μ… μ‹ μ΄λ©”μΌ,μ•„μ΄λ”” μ¤‘λ³µ μ²΄ν¬ μ°ν
- **μν–¥**: μ¤‘λ³µ μ‚¬μ©μ κ³„μ • μƒμ„±, λ°μ΄ν„° λ¬΄κ²°μ„± λ¬Έμ 
- **μμ‹**: κ°™μ€ μ‚¬μ©μκ°€ λ‹¤λ¥Έ μ΄λ©”μΌκ³Ό μ•„μ΄λ””λ΅ λ™μ‹ κ°€μ…
- (κ°™μ€ μ΄λ©”μΌ, μ•„μ΄λ””λ΅ λ™μ‹ κ°€μ… μ‹ μ¤‘λ³µ κ³„μ • μƒμ„±μ€ dbμ unique μ μ•½μ΅°κ±΄μΌλ΅ μ–΄λμ •λ„ ν•΄κ²°μ€ λλ” λ“― ν•¨)

---

## π”¬ λ™μ‹μ„± λ¬Έμ  λ¶„μ„

### 2.1 λ™μ‹μ„± λ¬Έμ μ μ›μΈ

#### **2.1.1 Race Condition**
```
μ‹κ°„ | Thread A          | Thread B
-----|-------------------|-------------------
T1   | ν¬μΈνΈ μ΅°ν(1000) | 
T2   |                   | ν¬μΈνΈ μ΅°ν(1000)
T3   | ν¬μΈνΈ μ°¨κ°(500)  |
T4   |                   | ν¬μΈνΈ μ°¨κ°(500)
T5   | μ €μ¥(500)         |
T6   |                   | μ €μ¥(500) β† λ¬Έμ !
```

#### **2.1.2 λ°μ΄ν„°λ² μ΄μ¤ κ²©λ¦¬ μμ¤€ λ¬Έμ **
- **Read Uncommitted**: Dirty Read λ°μƒ
- **Read Committed**: Non-Repeatable Read λ°μƒ
- **Repeatable Read**: Phantom Read λ°μƒ
- **Serializable**: μ„±λ¥ μ €ν•

### 2.2 λΉ„μ¦λ‹μ¤ μ”κµ¬μ‚¬ν•­ λ¶„μ„

#### **2.2.1 μΏ ν° λ°κΈ‰**
- **μ”κµ¬μ‚¬ν•­**: μ„ μ°©μ μ›μΉ™ μ—„κ²© μ¤€μ
- **νΉμ„±**: μμ„ λ³΄μ¥μ΄ λΉ„μ¦λ‹μ¤ ν•µμ‹¬
- **λ™μ‹μ„± μμ¤€**: λ†’μ (λ€λ‰ λ™μ‹ μ”μ²­)

#### **2.2.2 ν¬μΈνΈ κ΄€λ¦¬**
- **μ”κµ¬μ‚¬ν•­**: μ •ν™•ν• μ”μ•΅ μ μ§€
- **νΉμ„±**: μ„±λ¥μ΄ μ¤‘μ”ν•μ§€λ§ μ •ν™•μ„± ν•„μ
- **λ™μ‹μ„± μμ¤€**: μ¤‘κ°„ (κ°λ³„ μ‚¬μ©μλ³„)

#### **2.2.3 μ£Όλ¬Έ μ²λ¦¬**
- **μ”κµ¬μ‚¬ν•­**: μ¬κ³  μ •ν™•μ„±, μΏ ν° μ¤‘λ³µ μ‚¬μ© λ°©μ§€
- **νΉμ„±**: λ³µμ΅ν• νΈλμ­μ…, μ„±λ¥ μ¤‘μ”
- **λ™μ‹μ„± μμ¤€**: μ¤‘κ°„ (μƒν’λ³„, μ‚¬μ©μλ³„)

##### μΏ ν° λ°κΈ‰ μ΄μ™Έμ—λ” μ •μƒμ μΈ λ£¨νΈκ°€ μ•„λ‹λΌκ³  μƒκ°ν•¨
 - 'μ„ μ°©μ' μΏ ν° λ°κΈ‰μ€ ν•„μ—°μ μΌλ΅ λ™μ‹μ„± μ΄μκ°€ λ°μƒν•λ©°, λ°μ΄ν„°μ μ •ν•©μ„± μ μ§€κ°€ λ§¤μ° μ¤‘μ”ν•  κ²ƒμ΄λΌκ³  νλ‹¨λ¨
 - ν•μ§€λ§ κ·Έ μ™Έ κΈ°λ¥μ€ μ•…μμ μΌλ΅ λ™μ‹μ— μ‹¤ν–‰ν•λ ¤λ” κ²½μ°κ°€ μ•„λ‹λΌλ©΄, λ™μ‹μ„± μ΄μκ°€ λΉλ²ν•μ§€λ” μ•μ„ κ²ƒμ΄λΌκ³  μƒκ°ν•¨
 - κ·Έλμ„ μΏ ν° λ°κΈ‰μ—” λΉ„κ΄€μ , λ‚λ¨Έμ§€λ” λ‚™κ΄€μ  λ½ μ „λµμ„ μ‚¬μ©ν•¨
 - κ·Έλ‚λ§ μ •μƒμ μΈ μƒν™©μ—μ„ λ™μ‹μ„± μ΄μκ°€ λ°μƒν• λ§ν• μ„λΉ„μ¤λ” μ£Όλ¬Έ μƒμ„±μΈλ°, μΈκΈ°μƒν’μ΄λ‚ μ‹ μƒν’, μ¬κ³ κ°€ μΌμ •μμ¤€ μ΄ν•λ΅ λ–¨μ–΄μ΅μ„λ• λΉ„κ΄€μ  λ½μ„ μ‚¬μ©ν•λ” λ°©μ‹μΌλ΅ μ§„ν–‰ν•λ©΄ μ–΄λ–¨μ§€ κ³ λ―Όλ―Ό
---

## π› οΈ ν•΄κ²° λ°©μ•

### 3.1 λ™μ‹μ„± μ μ–΄ μ „λµ

#### **3.1.1 ν™•μ¥μ„± κ³ λ ¤ν• μ ‘κ·Ό**
```
ν„μ¬: λ‹¨μΌ μ„λ²„, λ‹¨μΌ DB
β†“
λ―Έλ: λ‹¤μ¤‘ μ„λ²„, λ¶„μ‚° DB
```

**μ „λµ**: ν™•μ¥ κ°€λ¥ν• μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ λ™μ‹μ„± μ μ–΄ μ°μ„ 

#### **3.1.2 λ‹¨κ³„μ  κµ¬ν„ κ³„ν**
1. **1λ‹¨κ³„**: μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ λ½ (ν„μ¬)
2. **2λ‹¨κ³„**: Redis λ¶„μ‚° λ½ (λ‹¤μ¤‘ μ„λ²„)
3. **3λ‹¨κ³„**: DB λ¬Όλ¦¬μ  λ½ (λ³΄μ΅°μ )

### 3.2 λ½ νƒ€μ… μ„ νƒ κΈ°μ¤€

#### **3.2.1 λΉ„κ΄€μ  λ½ (Pessimistic Lock)**
**μ μ© λ€μƒ**: μΏ ν° λ°κΈ‰
**μ„ νƒ μ΄μ **:
- μ •ν™•ν• μμ„ λ³΄μ¥ ν•„μ
- μ„ μ°©μ μ›μΉ™μ΄ λΉ„μ¦λ‹μ¤ ν•µμ‹¬
- λ™μ‹ μ”μ²­μ΄ λ§μ„ λ• μμ„ λ³΄μ¥ ν•„μ”

**κµ¬ν„ λ°©μ‹**:
```typescript
@PessimisticLock({
  key: 'coupon:issue:${args[0].couponType}',
  timeout: 5000,
  errorMessage: 'μΏ ν° λ°κΈ‰ μ¤‘μ…λ‹λ‹¤. μ μ‹ ν›„ λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.'
})
```

#### **3.2.2 λ‚™κ΄€μ  λ½ (Optimistic Lock)**
**μ μ© λ€μƒ**: ν¬μΈνΈ μ¶©μ „/μ°¨κ°, μ£Όλ¬Έ μƒμ„±, νμ›κ°€μ…
**μ„ νƒ μ΄μ **:
- μ¶©λμ΄ μ κ³  μ„±λ¥μ΄ μ¤‘μ”ν• ν™κ²½
- μ¬μ‹λ„ λ΅μ§μΌλ΅ μ¶©λ ν•΄κ²° κ°€λ¥
- λΉ„μ¦λ‹μ¤ λ΅μ§μΌλ΅ μ¶©λ λ°©μ§€

**κµ¬ν„ λ°©μ‹**:
```typescript
@OptimisticLock({
  key: 'points:charge:${args[0]}',
  maxRetries: 3,
  retryDelay: 100,
  errorMessage: 'ν¬μΈνΈ μ¶©μ „ μ¤‘μ…λ‹λ‹¤. μ μ‹ ν›„ λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.'
})
```

### 3.3 κΈ°μ μ  κµ¬ν„

#### **3.3.1 λ°μ½”λ μ΄ν„° ν¨ν„΄**
```typescript
// λ‚™κ΄€μ  λ½ λ°μ½”λ μ΄ν„°
@OptimisticLock({
  key: 'register:${args[0].email}',
  maxRetries: 3,
  retryDelay: 100
})

// λΉ„κ΄€μ  λ½ λ°μ½”λ μ΄ν„°
@PessimisticLock({
  key: 'coupon:issue:${args[0].couponType}',
  timeout: 5000
})
```

#### **3.3.2 μΈν„°μ…‰ν„° κµ¬ν„**
- **OptimisticLockInterceptor**: μ¬μ‹λ„ λ΅μ§ μ²λ¦¬
- **PessimisticLockInterceptor**: λ©”λ¨λ¦¬ κΈ°λ° λ½ κ΄€λ¦¬
- **TransactionInterceptor**: νΈλμ­μ… κ΄€λ¦¬

#### **3.3.3 λ²„μ „ κ΄€λ¦¬**
```typescript
// TypeORM @VersionColumn() ν™μ©
@VersionColumn()
version: number;
```

---

## β… κµ¬ν„ κ²°κ³Ό

### 4.1 μ μ©λ λ™μ‹μ„± μ μ–΄

| κΈ°λ¥ | λ½ νƒ€μ… | κµ¬ν„ μƒνƒ | ν…μ¤νΈ μƒνƒ |
|------|----------|-----------|-------------|
| **μΏ ν° λ°κΈ‰** | λΉ„κ΄€μ  λ½ | β… μ™„λ£ | β… ν†µκ³Ό |
| **ν¬μΈνΈ μ¶©μ „** | λ‚™κ΄€μ  λ½ | β… μ™„λ£ | β… ν†µκ³Ό |
| **ν¬μΈνΈ μ°¨κ°** | λ‚™κ΄€μ  λ½ | β… μ™„λ£ | β… ν†µκ³Ό |
| **μ£Όλ¬Έ μƒμ„±** | λ‚™κ΄€μ  λ½ | β… μ™„λ£ | β… ν†µκ³Ό |
| **νμ›κ°€μ…** | λ‚™κ΄€μ  λ½ | β… μ™„λ£ | β… ν†µκ³Ό |

### 4.2 ν•µμ‹¬ κµ¬ν„ νμΌ

#### **4.2.1 λ°μ½”λ μ΄ν„°**
- `src/common/decorators/optimistic-lock.decorator.ts`
- `src/common/decorators/pessimistic-lock.decorator.ts`
- `src/common/decorators/transactional.decorator.ts`

#### **4.2.2 μΈν„°μ…‰ν„°**
- `src/common/interceptors/optimistic-lock.interceptor.ts`
- `src/common/interceptors/pessimistic-lock.interceptor.ts`
- `src/common/interceptors/transaction.interceptor.ts`

#### **4.2.3 μ—”ν‹°ν‹° λ²„μ „ κ΄€λ¦¬**
- `src/infrastructure/repositories/typeorm/*.entity.ts`
- `src/domain/entities/*.entity.ts`

### 4.3 κµ¬ν„λ μ•μ •μ„± κΈ°λ¥

#### **4.3.1 μ•μ •μ„± λ³΄μ¥**
- **λ°λ“λ½ λ°©μ§€**: νƒ€μ„μ•„μ›ƒ μ„¤μ • (5μ΄)
- **μ¬μ‹λ„ λ΅μ§**: μµλ€ 3ν μ¬μ‹λ„ (λ‚™κ΄€μ  λ½)
- **μ—λ¬ μ²λ¦¬**: λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ μ κ³µ
- **νΈλμ­μ… λ΅¤λ°±**: μ‹¤ν¨ μ‹ λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥

#### **4.3.2 κµ¬ν„λ κΈ°λ¥**
- **λ‚™κ΄€μ  λ½**: μ¶©λ μ‹ μλ™ μ¬μ‹λ„
- **λΉ„κ΄€μ  λ½**: μμ„ λ³΄μ¥ λ° νƒ€μ„μ•„μ›ƒ μ²λ¦¬
- **λ²„μ „ κ΄€λ¦¬**: TypeORM @VersionColumn() ν™μ©

---

## π§ ν…μ¤νΈ λ° κ²€μ¦

### 5.1 ν…μ¤νΈ μ „λµ

#### **5.1.1 λ‹¨μ„ ν…μ¤νΈ**
- λ°μ½”λ μ΄ν„° μ μ© ν™•μΈ
- λ©”νƒ€λ°μ΄ν„° κ²€μ¦
- νΈλμ­μ… λ™μ‘ ν™•μΈ

#### **5.1.2 ν†µν•© ν…μ¤νΈ**
- λ™μ‹ μ”μ²­ μ‹λ®¬λ μ΄μ…
- μ‹¤μ  λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™
- μ„±λ¥ λ° μ•μ •μ„± κ²€μ¦

### 5.2 ν…μ¤νΈ κ²°κ³Ό

#### **5.2.1 λ‚™κ΄€μ  λ½ λ™μ‹μ„± ν…μ¤νΈ**
```typescript
// λ™μ‹ ν¬μΈνΈ μ¶©μ „ ν…μ¤νΈ
it('λ™μ‹ ν¬μΈνΈ μ¶©μ „ μ‹ λ‚™κ΄€μ  λ½μ΄ μ‘λ™ν•΄μ•Ό ν•λ‹¤', async () => {
  const promises = Array(10).fill(null).map(() => 
    chargePointsUseCase.execute(userId, chargePointsDto)
  );
  const results = await Promise.all(promises);
  expect(results).toHaveLength(10); // λ¨λ“  μ”μ²­ μ„±κ³µ
});

// λ™μ‹ μ£Όλ¬Έ μƒμ„± ν…μ¤νΈ
it('λ™μ‹ μ£Όλ¬Έ μƒμ„± μ‹ λ‚™κ΄€μ  λ½μ΄ μ‘λ™ν•΄μ•Ό ν•λ‹¤', async () => {
  const promises = Array(5).fill(null).map(() => 
    createOrderUseCase.execute(createOrderDto)
  );
  const results = await Promise.all(promises);
  expect(results).toHaveLength(5); // λ¨λ“  μ”μ²­ μ„±κ³µ
});

// μ¤‘λ³µ κ²°μ  λ°©μ§€ ν…μ¤νΈ
it('λ™μ‹ κ²°μ  μ²λ¦¬ μ‹ μ¤‘λ³µ κ²°μ κ°€ λ°©μ§€λμ–΄μ•Ό ν•λ‹¤', async () => {
  const results = await Promise.all(promises);
  expect(successResults.length).toBe(1); // μ •ν™•ν ν•λ‚λ§ μ„±κ³µ
  expect(failedResults.length).toBe(2); // λ‚λ¨Έμ§€λ” μ‹¤ν¨
});
```

#### **5.2.2 λΉ„κ΄€μ  λ½ λ™μ‹μ„± ν…μ¤νΈ**
```typescript
// λ™μ‹ μΏ ν° λ°κΈ‰ ν…μ¤νΈ
it('λ™μ‹ μΏ ν° λ°κΈ‰ μ‹ λΉ„κ΄€μ  λ½μ΄ μ‘λ™ν•΄μ•Ό ν•λ‹¤', async () => {
  const promises = Array(5).fill(null).map((_, index) => {
    const dto = new IssueCouponDto();
    dto.userId = 2 + index;
    dto.couponType = CouponType.DISCOUNT_10PERCENT;
    return issueCouponUseCase.execute(dto);
  });
  const results = await Promise.all(promises);
  expect(results).toHaveLength(5); // λ¨λ“  μ”μ²­ μ„±κ³µ (μμ„ λ³΄μ¥)
});

// μ„ μ°©μ μΏ ν° λ°κΈ‰ μμ„ λ³΄μ¥ ν…μ¤νΈ
it('μ„ μ°©μ μΏ ν° λ°κΈ‰μ—μ„ μμ„κ°€ λ³΄μ¥λμ–΄μ•Ό ν•λ‹¤', async () => {
  const results = [];
  for (let i = 0; i < 3; i++) {
    results.push(await issueCouponUseCase.execute(dto));
  }
  expect(results).toHaveLength(3); // μμ°¨μ  μ²λ¦¬ ν™•μΈ
});
```

#### **5.2.3 νμ›κ°€μ… λ™μ‹μ„± ν…μ¤νΈ**
```typescript
// λ™μ‹ νμ›κ°€μ… ν…μ¤νΈ (μ„λ΅ λ‹¤λ¥Έ μ΄λ©”μΌ)
it('λ™μ‹ νμ›κ°€μ… μ‹ λ‚™κ΄€μ  λ½μ΄ μ‘λ™ν•΄μ•Ό ν•λ‹¤', async () => {
  const promises = Array(5).fill(null).map((_, index) => {
    const registerDto = new RegisterDto();
    registerDto.email = `concurrent-test-${index}@example.com`;
    return registerUseCase.execute(registerDto);
  });
  const results = await Promise.all(promises);
  expect(results).toHaveLength(5); // λ¨λ“  μ”μ²­ μ„±κ³µ
});

// μ¤‘λ³µ μ΄λ©”μΌ λ™μ‹ κ°€μ… ν…μ¤νΈ
it('μ¤‘λ³µ μ΄λ©”μΌλ΅ λ™μ‹ κ°€μ… μ‹ λ‚™κ΄€μ  λ½μ΄ μ‘λ™ν•΄μ•Ό ν•λ‹¤', async () => {
  const results = await Promise.all(promises);
  const failedResults = results.filter(result => result instanceof Error);
  expect(failedResults.length).toBe(3); // μ¤‘λ³µμΌλ΅ μΈν• μ‹¤ν¨
});
```

#### **5.2.4 νΈλμ­μ… λ΅¤λ°± ν…μ¤νΈ**
```typescript
// ν¬μΈνΈ μ¶©μ „ μ‹¤ν¨ μ‹ νΈλμ­μ… λ΅¤λ°± ν…μ¤νΈ
it('ν¬μΈνΈ μ¶©μ „ μ‹¤ν¨ μ‹ νΈλμ­μ…μ΄ λ΅¤λ°±λμ–΄μ•Ό ν•λ‹¤', async () => {
  const initialPoints = await getUserPointsUseCase.execute(userId);
  await expect(chargePointsUseCase.execute(userId, chargePointsDto)).rejects.toThrow();
  const finalPoints = await getUserPointsUseCase.execute(userId);
  expect(finalPoints.balance).toBe(initialPoints.balance); // λ΅¤λ°± ν™•μΈ
});
```

### 5.3 κ²€μ¦ κ²°κ³Ό

#### **5.3.1 λ‚™κ΄€μ  λ½ κ²€μ¦**
- β… **λ™μ‹ ν¬μΈνΈ μ¶©μ „**: 10κ° μ”μ²­ λ¨λ‘ μ„±κ³µ (μ¬μ‹λ„ λ΅μ§)
- β… **λ™μ‹ μ£Όλ¬Έ μƒμ„±**: 5κ° μ”μ²­ λ¨λ‘ μ„±κ³µ (μ¬κ³  μ •ν™•μ„±)
- β… **μ¤‘λ³µ κ²°μ  λ°©μ§€**: 1κ° μ„±κ³µ, 2κ° μ‹¤ν¨ (μ¤‘λ³µ λ°©μ§€)
- β… **λ™μ‹ νμ›κ°€μ…**: 5κ° μ”μ²­ λ¨λ‘ μ„±κ³µ (μ„λ΅ λ‹¤λ¥Έ μ΄λ©”μΌ)
- β… **μ¤‘λ³µ μ΄λ©”μΌ κ°€μ…**: 1κ° μ„±κ³µ, 3κ° μ‹¤ν¨ (μ¤‘λ³µ λ°©μ§€)

#### **5.3.2 λΉ„κ΄€μ  λ½ κ²€μ¦**
- β… **λ™μ‹ μΏ ν° λ°κΈ‰**: 5κ° μ”μ²­ λ¨λ‘ μ„±κ³µ (μμ„ λ³΄μ¥)
- β… **μ„ μ°©μ μΏ ν° λ°κΈ‰**: 3κ° μμ°¨ μ²λ¦¬ (μμ„ λ³΄μ¥)

#### **5.3.3 νΈλμ­μ… κ²€μ¦**
- β… **νΈλμ­μ… λ΅¤λ°±**: ν¬μΈνΈ μ¶©μ „ μ‹¤ν¨ μ‹ λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥
- β… **μ—λ¬ μ²λ¦¬**: λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ λ° μ μ ν• μ‹¤ν¨ μ‘λ‹µ

---

## π€ ν–¥ν›„ ν™•μ¥ κ³„ν (STEP10μ—μ„ κµ¬ν„ μμ •)

### 6.1 Redis λ¶„μ‚° λ½ κµ¬ν„

#### **6.1.1 κµ¬ν„ κ³„ν**
```typescript
// Redis λ¶„μ‚° λ½ μΈν„°νμ΄μ¤
interface DistributedLockService {
  acquireLock(key: string, ttl: number): Promise<boolean>;
  releaseLock(key: string): Promise<void>;
}
```

#### **6.1.2 μ μ© λ€μƒ**
- λ‹¤μ¤‘ μ„λ²„ ν™κ²½
- λ†’μ€ λ™μ‹μ„± μ”κµ¬μ‚¬ν•­
- κΈ€λ΅λ² λ½ ν•„μ” μ‹

### 6.2 DB λ¬Όλ¦¬μ  λ½ κµ¬ν„

#### **6.2.1 κµ¬ν„ κ³„ν**
```sql
-- Row-Level Lock (ν–‰ λ‹¨μ„ λ½)
SELECT * FROM users WHERE id = ? FOR UPDATE;
SELECT * FROM products WHERE id = ? FOR UPDATE NOWAIT;

-- Shared Lock (κ³µμ  λ½)
SELECT * FROM products WHERE id = ? FOR SHARE;

-- Table-Level Lock (ν…μ΄λΈ” λ½)
LOCK TABLES users WRITE, products READ;
```

```typescript
// TypeORMμ—μ„μ λ¬Όλ¦¬μ  λ½ κµ¬ν„
@Transactional()
async processWithPhysicalLock(userId: number, productId: number) {
  const user = await this.userRepository.findOne({
    where: { id: userId },
    lock: { mode: 'pessimistic_write' }
  });
  
  const product = await this.productRepository.findOne({
    where: { id: productId },
    lock: { mode: 'pessimistic_write' }
  });
  
  // λΉ„μ¦λ‹μ¤ λ΅μ§ μν–‰
}
```

#### **6.2.2 μ μ© λ€μƒ**
- λ‹¨μΌ DB ν™κ²½
- λ³µμ΅ν• νΈλμ­μ…
- λ°μ΄ν„° μΌκ΄€μ„± μµμ°μ„ 
- λ°λ“λ½ λ°©μ§€κ°€ μ¤‘μ”ν• ν™κ²½

---

## π“ κ²°λ΅ 

### 7.1 μ„±κ³Ό μ”μ•½

1. **λ™μ‹μ„± λ¬Έμ  μ‹λ³„**: 5κ° ν•µμ‹¬ κΈ°λ¥μ—μ„ λ™μ‹μ„± λ¬Έμ  λ°κ²¬
2. **μ μ ν• ν•΄κ²° λ°©μ•**: λΉ„μ¦λ‹μ¤ μ”κµ¬μ‚¬ν•­μ— λ§λ” λ½ νƒ€μ… μ„ νƒ
3. **ν™•μ¥ κ°€λ¥ν• κµ¬ν„**: ν–¥ν›„ λ‹¤μ¤‘ μ„λ²„ ν™κ²½ λ€λΉ„
4. **μ™„μ „ν• ν…μ¤νΈ**: λ‹¨μ„/ν†µν•© ν…μ¤νΈλ΅ κ²€μ¦ μ™„λ£

### 7.2 ν•µμ‹¬ μ„±κ³Ό

- β… **μ„ μ°©μ μΏ ν°**: λΉ„κ΄€μ  λ½μΌλ΅ μμ„ λ³΄μ¥
- β… **ν¬μΈνΈ κ΄€λ¦¬**: λ‚™κ΄€μ  λ½μΌλ΅ μ„±λ¥ μµμ ν™”
- β… **μ£Όλ¬Έ μ²λ¦¬**: λ³µμ΅ν• νΈλμ­μ… μ•μ „μ„± ν™•λ³΄
- β… **νμ›κ°€μ…**: μ¤‘λ³µ κ³„μ • μƒμ„± λ°©μ§€

### 7.3 ν–¥ν›„ κ³Όμ 

1. **Redis λ¶„μ‚° λ½**: λ‹¤μ¤‘ μ„λ²„ ν™κ²½ λ€λΉ„
2. **μ„±λ¥ μµμ ν™”**: λ¶€ν• ν…μ¤νΈ λ° νλ‹

---