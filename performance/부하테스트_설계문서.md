# 부하테스트 설계문서 — **쿠폰 발급 시나리오**


## 2. 테스트 대상 선정

### 2.1 선착순 쿠폰 발급 시스템

* **선정 이유**: 마케팅 이벤트 시 단시간에 대량 트래픽이 발생하고, 제한된 재고(예: 450개)에 대한 경쟁으로 인한 동시성/정합성 문제가 발생할 가능성이 높음.
* **테스트 목적**: 동시 다수의 접근(스파이크) 상황에서 쿠폰 재고 관리의 정확성(중복 지급/오버셀 여부)과 시스템의 응답성/안정성 검증.

## 3. 테스트 시나리오

| 기능    | 대상 동시 사용자(스파이크) | 총 테스트 시간 | 주요 시나리오                                                          |
| ----- | --------------: | -------: | ---------------------------------------------------------------- |
| 쿠폰 발급(동기) |      200명 동시 접속 |       9분 | 마케팅 이벤트성 쿠폰 발급 러시(스파이크형 트래픽) — 동시성 높은 진입 시 재고 동기화 및 실패/재시도 처리 검증 |
| 쿠폰 발급(비동기) |      300명 동시 접속 |      14분 | 카프카 기반 비동기 쿠폰 발급 처리 — 높은 처리량과 안정성 검증 |

> 테스트는 스파이크(동시 진입) 형태로 진행하며, 필요한 경우 워밍업/스테디 스테이트/랭다운 구간을 추가하여 시스템 상태를 관찰한다.

## 4. 성능 목표

### 4.1 응답 시간 목표

* **p95 응답시간(동기 쿠폰 발급)**: **≤ 1.0 s** (목표)
* **p95 응답시간(비동기 쿠폰 발급)**: **≤ 2.0 s** (목표)
* 권장(우수) 수준: **p95 ≤ 500 ms**

### 4.2 성공율 및 에러율 목표

* **동기 쿠폰 발급 성공율**: **≥ 0.1%** (선착순 특성상 낮은 성공율이 정상)
* **비동기 쿠폰 발급 성공율**: **≥ 95%** (비동기 요청 수락 성공율)
* **서버 에러율**: **≤ 5%** (쿠폰 소진으로 인한 400 에러는 정상)

> 참고: 성공율/에러율 목표는 서비스 수준 협약(SLA) 및 비즈니스 요구에 따라 조정 가능.

## 5. 테스트 실행

### 5.1 자동화 실행

```bash
# 동기 쿠폰 발급 테스트
k6 run performance/coupon-issue-load-test.k6.js

# 비동기 쿠폰 발급 테스트  
k6 run performance/coupon-issue-async-load-test.k6.js
```

### 5.2 테스트 환경

* **API 서버**: `localhost:3000` (또는 테스트 전용 인스턴스)
* **데이터베이스**: MySQL 8.0
* **캐시**: Redis 7
* **메시지 큐**: Apache Kafka
* **테스트 도구**: k6

### 5.3 테스트 데이터

* **사용자(시뮬레이션)**: 1,000명 (ID: 1–1000)
* **상품**: 10개 (ID: 1–10)
* **쿠폰 재고**: 450개 (타입별 분산)