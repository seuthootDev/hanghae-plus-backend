## :pushpin: PR 제목 규칙
[STEP09] 정승훈 - e-commerce

---
### 동시성 처리가 필요하다고 느낀 서비스

#### **비관적 락 (Pessimistic Lock)**
- **쿠폰 발급**
  - 선착순 쿠폰의 정확한 순서 보장이 필수
  - 쿠폰 수량이 제한적이고 선착순 원칙이 비즈니스 핵심
  - 동시 요청이 많을 때 순서 보장 필요

#### **낙관적 락 (Optimistic Lock)**
- **포인트 차감/충전**
- **주문 생성**
- **회원가입**
  - 충돌이 적고 성능이 중요한 환경
  - 중복 체크로 충돌 방지

#### **선택 기준**
- **비관적 락**: 정확한 순서 보장이 필수인 경우 (선착순 쿠폰)
- **낙관적 락**: 충돌이 적고 성능이 중요한 경우 (포인트, 주문, 회원가입)

### 동시성 처리 전략
#### 방향
  - 현재는 단일 서버, 단일 디비를 사용하지만, 다중 서버 다중 디비를 염두해 둔 동시성 제어 기법을 사용하는 것이 목표
  - 뮤텍스, 세마포어같은 메모리 기반 방식은 다중 서버 환경에서는 무용지물
  - 디비 물리적 락은 분산 디비에서 사용할 수 없음
#### 목표
  - 트랜젝션 락을 활용해서 어플리케이션 레벨에서의 동시성 제어를 우선 목표로 한다
  - 이후 레디스 락을 활용해서 다중 서버 환경에서의 동시성 제어를 구현
  - 데이터베이스 물리적 락을 구현한다 (단일이든 다중이든)

## :clipboard: 핵심 체크리스트 :white_check_mark:

### STEP09 - Concurrency (2개)
- [✔️] 애플리케이션 내에서 발생 가능한 **동시성 문제를 식별**했는가?
- [✔️] 보고서에 DB를 활용한 **동시성 문제 해결 방안**이 포함되어 있는가?
- [`15f5265`](https://github.com/seuthootDev/hanghae-plus-backend/commit/15f52656b3481c4d2fd47c0fe9f005642d9221e3) 

---

### STEP10 - Finalize (1개)
- [✔️] **동시성 문제를 드러낼 수 있는 통합 테스트**를 작성했는가?
- [`5e45758`](https://github.com/seuthootDev/hanghae-plus-backend/commit/5e457589862041efdffa75351e2fb989b006fb87)
- [`89a906b`](https://github.com/seuthootDev/hanghae-plus-backend/commit/89a906b25202378cfc4e7ccad5acd422ecef1b96)
- [`63b1509`](https://github.com/seuthootDev/hanghae-plus-backend/commit/63b15098f1121380ce1a97d4e422a5bfbfde52ef)
- [`488eed7`](https://github.com/seuthootDev/hanghae-plus-backend/commit/488eed7fb510d7808bb7c6a1d726e1db6e323646)

---

## ✍️ 간단 회고 (3줄 이내)
- **잘한 점**: 락을 어디서 걸어야 하는지에 대한 고민
- **어려웠던 점**: 분산락,트랜젝션락,db락이 충돌이 없도록 하는 것이 어려웠음
- **다음 시도**:  조건부 비관적 락 사용용

# 피드백 받고 싶은 사항

### 동시성 제어 전락
- 동시성 제어 전략을 수립할 때, 확장성에 우선순위를 두었습니다.  
  그 이유는, 뮤텍스나 세마포어 같은 기법은 단일 서버 환경에서만 유효하며, 분산 락은 다중 서버에서 유효하고,
  분산 데이터베이스 환경에서는 물리적 락 또한 제약이 많아 무용지물에 가깝다고 판단했기 때문입니다.  
  프로젝트 규모나 구조가 초기에는 명확하지 않기 때문에, 확장 가능한 방향성을 고려하는 것이 중요하다고 생각했습니다.

- 이에 따라 전략을 다음과 같은 단계로 구상했습니다:  
  트랜잭션 락을 활용한 애플리케이션 레벨 동시성 제어 → Redis 기반 분산 락 → DB 물리적 락.  
  먼저 애플리케이션 레벨에서 동시성 제어가 완전하게 작동한다면,  
  다중 서버 환경에서도 동일한 로직으로 동시성 문제가 해결될 수 있을 것이라 기대했으며,  
  그 위에 보조 수단으로 Redis 분산 락을 추가 적용.  
  물리적 락은 또한 보조적 수단으로 추가 적용.  
  이후 분산 DB 환경에서 좀 더 세밀한 락 제어가 필요하다면,물리적 락을 더 보완하는 방식으로 확장할 수 있을 것이라 판단했습니다.

### 동시성 제어 보고서 내용 중 일부 (비관적, 낙관적 락 전략)
 - '선착순' 쿠폰 발급은 필연적으로 동시성 이슈가 발생하며, 데이터의 정합성 유지가 매우 중요할 것이라고 판단됨
 - 하지만 그 외 기능은 악의적으로 동시에 실행하려는 경우가 아니라면, 동시성 이슈가 빈번하지는 않을 것이라고 생각함
 - 그래서 쿠폰 발급엔 비관적, 나머지는 낙관적 락 전략을 사용함
 - 그나마 정상적인 상황에서 동시성 이슈가 발생할만한 서비스는 주문 생성인데, 인기상품이나 신상품, 재고가 일정수준 이하로 떨어졌을때 비관적 락을 사용하는 방식으로 진행하면 어떨지 고민

  #### 혹시 제가 잘못 생각하고 있는 부분이 있나요? 알려주시면 감사하겠습니다.
